{"version":3,"sources":["Rendition.js"],"names":["URL","require","EPUBJS","BRIDGE","EMBEDDED_HTML","Rendition","props","state","loaded","_isMounted","url","load","destroy","prevProps","display","orientation","flow","themes","theme","fontSize","font","bookUrl","_webviewLoaded","__DEV__","console","log","config","minSpreadWidth","stylesheet","webviewStylesheet","script","sendToBridge","target","spine","f","t","locations","isReady","cfiRange","data","str","refs","webviewbridge","postMessage","method","args","promiseId","JSON","stringify","promise","e","msg","nativeEvent","decoded","parse","p","apply","value","onError","error","_onWebViewLoaded","setState","location","_relocated","size","width","height","onPress","cfi","position","onLongPress","_selected","_markClicked","sectionIndex","onViewAdded","beforeViewRemoved","_ready","visibleLocation","_visibleLocation","onRelocated","onSelected","onMarkClicked","onDisplayed","WebViewer","OS","loader","styles","loadScreen","backgroundColor","color","flex","container","html","baseUrl","manager","_onBridgeMessage","bind","create","flexDirection","scrollContainer","marginTop","flexWrap","rowContainer","top","bottom","left","right","justifyContent","alignItems","prototype","module","exports"],"mappings":"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","file":"Rendition.js","sourcesContent":["import React, { Component } from \"react\"\n\nimport {\n  StyleSheet,\n  View,\n  ActivityIndicator,\n  AsyncStorage,\n  Dimensions,\n  Platform,\n  AppState,\n  WebView,\n  TouchableOpacity\n} from \"react-native\";\n\nimport WKWebView from 'react-native-wkwebview-reborn';\n\nimport EventEmitter from 'event-emitter';\n\nimport { readFileSync } from \"fs\";\n\nconst URL = require(\"epubjs/libs/url/url-polyfill.js\");\n\nconst EPUBJS = readFileSync(__dirname + \"/../node_modules/epubjs/dist/epub.min.js\", \"utf8\");\nconst BRIDGE = readFileSync(__dirname + \"/../contents/bridge.js\", \"utf8\");\n\nconst EMBEDDED_HTML = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no\">\n  <title>epubjs</title>\n  <script>${EPUBJS}</script>\n  <script>${BRIDGE}</script>\n  <style>\n    body {\n      margin: 0;\n      -webkit-tap-highlight-color: rgba(0,0,0,0);\n      -webkit-tap-highlight-color: transparent; /* For some Androids */\n    }\n  </style>\n</head><body></body></html>\n`;\n\nclass Rendition extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      loaded: false,\n    }\n\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n\n    if (this.props.url) {\n      this.load(this.props.url);\n    }\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n    this.destroy();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.url !== this.props.url) {\n      this.load(this.props.url);\n    }\n\n    if (prevProps.display !== this.props.display) {\n      // this.setState({ loaded: false });\n      this.display(this.props.display);\n    }\n\n    if (prevProps.orientation !== this.props.orientation) {\n      // this.setState({ loaded: false });\n    }\n\n    if (prevProps.flow !== this.props.flow) {\n      this.flow(this.props.flow || \"paginated\");\n    }\n\n    if (prevProps.themes !== this.props.themes) {\n      this.themes(this.props.themes);\n    }\n\n    if (prevProps.themes !== this.props.theme) {\n      this.theme(this.props.theme);\n    }\n\n    if (prevProps.fontSize !== this.props.fontSize) {\n      this.fontSize(this.props.fontSize);\n    }\n\n    if (prevProps.font !== this.props.font) {\n      this.font(this.props.font);\n    }\n  }\n\n  load(bookUrl) {\n    if (!this._webviewLoaded) return;\n\n    __DEV__ && console.log(\"[Rendition] loading book: \", bookUrl);\n\n    let config = {\n      \"minSpreadWidth\": this.props.minSpreadWidth || 800,\n      \"flow\": this.props.flow || \"paginated\",\n    };\n\n    if (this.props.stylesheet) {\n      config.stylesheet = this.props.stylesheet;\n    }\n\n    if (this.props.webviewStylesheet) {\n      config.webviewStylesheet = this.props.webviewStylesheet;\n    }\n\n    if (this.props.script) {\n      config.script = this.props.script;\n    }\n\n    this.sendToBridge(\"open\", [bookUrl, config]);\n\n    this.display(this.props.display);\n\n    if (this.props.themes) {\n      this.themes(this.props.themes);\n    }\n\n    if (this.props.theme) {\n      this.theme(this.props.theme);\n    }\n\n    if (this.props.fontSize) {\n      this.fontSize(this.props.fontSize);\n    }\n\n    if (this.props.font) {\n      this.font(this.props.font);\n    }\n  }\n\n  display(target) {\n    let spine = typeof target === \"number\" && target;\n\n    if (!this._webviewLoaded) return;\n\n    if (spine) {\n      this.sendToBridge(\"display\", [{ \"spine\": spine}]);\n    } else if (target) {\n      this.sendToBridge(\"display\", [{ \"target\": target}]);\n    } else {\n      this.sendToBridge(\"display\");\n    }\n  }\n\n  flow(f) {\n    this.sendToBridge(\"flow\", [f]);\n  }\n\n  themes(t) {\n    this.sendToBridge(\"themes\", [t]);\n  }\n\n  theme(t) {\n    this.sendToBridge(\"theme\", [t]);\n  }\n\n  font(f) {\n    this.sendToBridge(\"font\", [f]);\n  }\n\n  fontSize(f) {\n    this.sendToBridge(\"fontSize\", [f]);\n  }\n\n  setLocations(locations) {\n    this.locations = locations;\n    if (this.isReady) {\n      this.sendToBridge(\"setLocations\", [this.locations]);\n    }\n  }\n\n  reportLocation() {\n    if (this.isReady) {\n      this.sendToBridge(\"reportLocation\");\n    }\n  }\n\n  highlight (cfiRange, data) {\n    this.sendToBridge(\"highlight\", [cfiRange, data]);\n  }\n\n  underline (cfiRange, data) {\n    this.sendToBridge(\"underline\", [cfiRange, data]);\n  }\n\n  mark (cfiRange, data) {\n    this.sendToBridge(\"mark\", [cfiRange, data]);\n\t}\n\n  unhighlight (cfiRange, data) {\n    this.sendToBridge(\"removeAnnotation\", [cfiRange, data]);\n\t}\n\n\tununderline (cfiRange, data) {\n    this.sendToBridge(\"removeAnnotation\", [cfiRange, data]);\n\t}\n\n\tunmark (cfiRange, data) {\n    this.sendToBridge(\"removeAnnotation\", [cfiRange, data]);\n\t}\n\n  next() {\n    this.sendToBridge(\"next\");\n  }\n\n  prev() {\n    this.sendToBridge(\"prev\");\n  }\n\n  destroy() {\n\n  }\n\n  postMessage(str) {\n    if (this.refs.webviewbridge) {\n      return this.refs.webviewbridge.postMessage(str);\n    }\n  }\n\n  sendToBridge(method, args, promiseId) {\n    var str = JSON.stringify({\n      method: method,\n      args: args,\n      promise: promiseId\n    });\n\n    if (!this.refs.webviewbridge) {\n      return;\n    }\n\n    this.refs.webviewbridge.postMessage(str);\n  }\n\n  _onWebViewLoaded() {\n    this._webviewLoaded = true;\n    console.log('[Rendition] Web view has loaded');\n    if (this.props.url) {\n      this.load(this.props.url);\n    }\n  }\n\n  _onBridgeMessage(e) {\n    var msg = e.nativeEvent.data;\n    var decoded;\n    if (typeof msg === \"string\") {\n      decoded = JSON.parse(msg);\n    } else {\n      decoded = msg; // webkit may pass parsed objects\n    }\n    var p;\n\n    switch (decoded.method) {\n      case \"log\": {\n        console.log.apply(console.log, [decoded.value]);\n        break;\n      }\n      case \"error\": {\n        if (this.props.onError) {\n          this.props.onError(decoded.value);\n        } else {\n          console.error.apply(console.error, [decoded.value]);\n        }\n        break;\n      }\n      case \"loaded\": {\n        this._onWebViewLoaded();\n        break;\n      }\n      case \"rendered\": {\n        console.log(\"[Rendition] rendered\");\n        if (!this.state.loaded) {\n          this.setState({loaded: true});\n        }\n        break;\n      }\n      case \"relocated\": {\n        let {location} = decoded;\n        this._relocated(location);\n        if (!this.state.loaded) {\n          this.setState({loaded: true});\n        }\n        break;\n      }\n      case \"resized\": {\n        let {size} = decoded;\n        console.log(\"resized\", size.width, size.height);\n        break;\n      }\n      case \"press\": {\n        this.props.onPress && this.props.onPress(decoded.cfi, decoded.position, this);\n        break;\n      }\n      case \"longpress\": {\n        this.props.onLongPress && this.props.onLongPress(decoded.cfi, this);\n        break;\n      }\n      case \"selected\": {\n        let {cfiRange} = decoded;\n        this._selected(cfiRange);\n        break;\n      }\n      case \"markClicked\": {\n        let {cfiRange, data} = decoded;\n        this._markClicked(cfiRange, data);\n        break;\n      }\n      case \"added\": {\n        let {sectionIndex} = decoded;\n        this.props.onViewAdded && this.props.onViewAdded(sectionIndex);\n        break;\n      }\n      case \"removed\": {\n        let {sectionIndex} = decoded;\n        this.props.beforeViewRemoved && this.props.beforeViewRemoved(sectionIndex);\n        break;\n      }\n      case \"ready\": {\n        console.log(\"[Rendition] ready\");\n        this._ready();\n        break;\n      }\n      default: {\n        console.log(\"[Rendition] msg\", decoded);\n      }\n    }\n  }\n\n  _relocated(visibleLocation) {\n    this._visibleLocation = visibleLocation;\n    if (this.props.onRelocated) {\n      this.props.onRelocated(visibleLocation, this);\n    }\n  }\n\n  _selected(cfiRange) {\n    if (this.props.onSelected) {\n      this.props.onSelected(cfiRange, this);\n    }\n  }\n\n  _markClicked(cfiRange, data) {\n    if (this.props.onMarkClicked) {\n      this.props.onMarkClicked(cfiRange, data, this);\n    }\n  }\n\n  _ready() {\n    this.isReady = true;\n    if (this.locations) {\n      this.sendToBridge(\"setLocations\", [this.locations]);\n    }\n    this.props.onDisplayed && this.props.onDisplayed();\n  }\n\n  render() {\n    const WebViewer = (Platform.OS === 'ios') ? WKWebView : WebView;\n\n    let loader = (\n      <TouchableOpacity onPress={() => this.props.onPress('')} style={styles.loadScreen}>\n        <View style={[styles.loadScreen, {\n            backgroundColor: this.props.backgroundColor || \"#FFFFFF\"\n          }]}>\n            <ActivityIndicator\n                color={this.props.color || \"black\"}\n                size={this.props.size || \"large\"}\n                style={{ flex: 1 }}\n              />\n        </View>\n      </TouchableOpacity>\n    );\n\n    if (!this.props.url) {\n      return loader;\n    }\n\n    return (\n      <View ref=\"framer\" style={styles.container}>\n        <WebViewer\n          ref=\"webviewbridge\"\n          source={{html: EMBEDDED_HTML, baseUrl: this.props.url}}\n          style={[styles.manager, {\n            backgroundColor: this.props.backgroundColor || \"#FFFFFF\"\n          }]}\n          scalesPageToFit={false}\n          bounces={false}\n          javaScriptEnabled={true}\n          scrollEnabled={true}\n          pagingEnabled={this.props.flow === \"paginated\"}\n          // onLoadEnd={this._onWebViewLoaded.bind(this)}\n          onMessage={this._onBridgeMessage.bind(this)}\n        />\n        {!this.state.loaded ? loader : null}\n      </View>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    flexDirection: \"column\",\n  },\n  manager: {\n    flex: 1,\n  },\n  scrollContainer: {\n    flex: 1,\n    marginTop: 0,\n    flexDirection: \"row\",\n    flexWrap: \"nowrap\",\n    backgroundColor: \"#F8F8F8\",\n  },\n  rowContainer: {\n    flex: 1,\n  },\n  loadScreen: {\n    position: \"absolute\",\n    top: 0,\n    bottom: 0,\n    left: 0,\n    right: 0,\n    backgroundColor: \"#fff\",\n    justifyContent: \"center\",\n    alignItems: \"center\"\n  }\n});\n\nEventEmitter(Rendition.prototype);\n\nmodule.exports = Rendition;\n"]}