{"version":3,"sources":["Epub.js"],"names":["global","Blob","polyfill","JSZip","require","URL","btoa","encode","Rendition","Epub","props","bounds","get","state","toc","show","width","height","orientation","active","_isMounted","addEventListener","_handleAppStateChange","bind","addSpecificOrientationListener","_orientationDidChange","getInitialOrientation","setState","src","_loadBook","removeEventListener","removeSpecificOrientationListener","clearTimeout","orientationTimeout","destroy","nextProps","nextState","color","backgroundColor","size","flow","origin","onPress","onLongPress","stylesheet","javascript","prevProps","wait","_orientation","__DEV__","console","log","onOrientationChanged","bookUrl","book","replacements","base64","_openBook","useBase64","type","rendition","needsOpen","open","catch","err","error","ready","then","isReady","onReady","loaded","navigation","nav","onNavigationReady","generateLocations","loadLocations","locations","setLocations","onLocationsReady","key","getItem","stored","regenerateLocations","load","generate","locationsCharBreak","setItem","save","visibleLocation","_visibleLocation","onLocationChange","cfi","getRange","appState","r","apply","undefined","minSpreadWidth","webviewStylesheet","script","onSelected","onMarkClicked","onViewAdded","beforeViewRemoved","themes","theme","fontSize","font","location","onRelocated","onError","onDisplayed","module","exports"],"mappings":"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","file":"Epub.js","sourcesContent":["import React, { Component } from \"react\";\n\nimport {\n  StyleSheet,\n  View,\n  ActivityIndicator,\n  AsyncStorage,\n  Dimensions,\n  AppState,\n  WebView\n} from \"react-native\";\n\nimport Orientation from \"react-native-orientation\";\n\nimport RNFetchBlob from \"react-native-fetch-blob\"\n\nif (!global.Blob) {\n  global.Blob = RNFetchBlob.polyfill.Blob;\n}\n\nglobal.JSZip = global.JSZip || require(\"jszip\");\n\nglobal.URL = require(\"epubjs/libs/url/url-polyfill.js\");\n\nif (!global.btoa) {\n  global.btoa = require(\"base-64\").encode;\n}\n\nimport ePub, { Layout, EpubCFI } from \"epubjs\";\n\nconst Rendition = require(\"./Rendition\");\n\nclass Epub extends Component {\n\n  constructor(props) {\n    super(props);\n\n    var bounds = Dimensions.get(\"window\");\n\n    this.state = {\n      toc: [],\n      show: false,\n      width : bounds.width,\n      height : bounds.height,\n      orientation: \"PORTRAIT\"\n    }\n\n  }\n\n  componentDidMount() {\n    this.active = true;\n    this._isMounted = true;\n    AppState.addEventListener('change', this._handleAppStateChange.bind(this));\n\n    Orientation.addSpecificOrientationListener(this._orientationDidChange.bind(this));\n    let orientation = Orientation.getInitialOrientation();\n    if (orientation && (orientation === \"PORTRAITUPSIDEDOWN\" || orientation === \"UNKNOWN\")) {\n      orientation = \"PORTRAIT\";\n      this.setState({orientation})\n    } else if (orientation) {\n      this.setState({orientation})\n    } else if (orientation === null) {\n      // Android starts as null\n      orientation = this.state.width > this.state.height ? \"LANDSCAPE\" : \"PORTRAIT\";\n      this.setState({orientation})\n    }\n    // __DEV__ && console.log(\"inital orientation\", orientation, this.state.width, this.state.height)\n\n    if (this.props.src) {\n      this._loadBook(this.props.src);\n    }\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n\n    AppState.removeEventListener('change', this._handleAppStateChange);\n    Orientation.removeSpecificOrientationListener(this._orientationDidChange);\n    clearTimeout(this.orientationTimeout);\n\n    this.destroy();\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n\n    if (nextState.show !== this.state.show) {\n      return true;\n    }\n\n    if ((nextProps.width !== this.props.width) ||\n        (nextProps.height !== this.props.height)) {\n      return true;\n    }\n\n    if ((nextState.width !== this.state.width) ||\n        (nextState.height !== this.state.height)) {\n      return true;\n    }\n\n\n    if (nextProps.color != this.props.color) {\n      return true;\n    }\n\n    if (nextProps.backgroundColor != this.props.backgroundColor) {\n      return true;\n    }\n\n    if (nextProps.size != this.props.size) {\n      return true;\n    }\n\n    if (nextProps.flow != this.props.flow) {\n      return true;\n    }\n\n    if (nextProps.origin != this.props.origin) {\n      return true;\n    }\n\n    if (nextProps.orientation != this.props.orientation) {\n      return true;\n    }\n\n    if (nextProps.src != this.props.src) {\n      return true;\n    }\n\n    if (nextProps.onPress != this.props.onPress) {\n      return true;\n    }\n\n    if (nextProps.onLongPress != this.props.onLongPress) {\n      return true;\n    }\n\n    if (nextProps.stylesheet != this.props.stylesheet) {\n      return true;\n    }\n\n    if (nextProps.javascript != this.props.javascript) {\n      return true;\n    }\n\n    return false;\n  }\n\n  componentWillUpdate(nextProps) {\n    if (nextProps.src !== this.props.src) {\n      this.destroy();\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n\n    if (prevProps.src !== this.props.src) {\n      this._loadBook(this.props.src);\n    } else if (prevProps.orientation !== this.props.orientation) {\n      _orientationDidChange(this.props.orientation);\n    }\n  }\n\n  // LANDSCAPE PORTRAIT UNKNOWN PORTRAITUPSIDEDOWN\n  _orientationDidChange(orientation) {\n    let wait = 10;\n    let _orientation = orientation;\n\n    if(!this.active || !this._isMounted) return;\n\n    if (orientation === \"PORTRAITUPSIDEDOWN\" || orientation === \"UNKNOWN\") {\n      _orientation = \"PORTRAIT\";\n    }\n\n    if (orientation === \"LANDSCAPE-RIGHT\" || orientation === \"LANDSCAPE-LEFT\") {\n      _orientation = \"LANDSCAPE\";\n    }\n\n    if (this.state.orientation === _orientation) {\n      return;\n    }\n\n\n    __DEV__ && console.log(\"orientation\", _orientation);\n\n    this.setState({ orientation: _orientation });\n    this.props.onOrientationChanged && this.props.onOrientationChanged(_orientation);\n  }\n\n  _loadBook(bookUrl) {\n    __DEV__ && console.log(\"loading book: \", bookUrl);\n\n    this.book = ePub({\n      replacements: this.props.base64 || \"none\"\n    });\n\n    return this._openBook(bookUrl);\n\n    /*\n    var type = this.book.determineType(bookUrl);\n\n    var uri = new Uri(bookUrl);\n    if ((type === \"directory\") || (type === \"opf\")) {\n      return this._openBook(bookUrl);\n    } else {\n      return this.streamer.start()\n      .then((localOrigin) => {\n        this.setState({localOrigin})\n        return this.streamer.get(bookUrl);\n      })\n      .then((localUrl) => {\n        this.setState({localUrl})\n        return this._openBook(localUrl);\n      });\n    }\n    */\n  }\n\n  _openBook(bookUrl, useBase64) {\n    var type = useBase64 ? \"base64\" : null;\n\n    if (!this.rendition) {\n      this.needsOpen = [bookUrl, useBase64];\n      return;\n    }\n\n    this.book.open(bookUrl)\n      .catch((err) => {\n        console.error(err);\n      })\n\n    this.book.ready.then(() => {\n      this.isReady = true;\n      this.props.onReady && this.props.onReady(this.book);\n    });\n\n    this.book.loaded.navigation.then((nav) => {\n      if(!this.active || !this._isMounted) return;\n      this.setState({toc : nav.toc});\n      this.props.onNavigationReady && this.props.onNavigationReady(nav.toc);\n    });\n\n    if (this.props.generateLocations != false) {\n      this.loadLocations().then((locations) => {\n        this.rendition.setLocations(locations);\n        // this.rendition.reportLocation();\n        this.props.onLocationsReady && this.props.onLocationsReady(this.book.locations);\n      });\n    }\n\n  }\n\n  loadLocations() {\n    return this.book.ready.then(() => {\n      // Load in stored locations from json or local storage\n      var key = this.book.key()+\"-locations\";\n\n      return AsyncStorage.getItem(key).then((stored) => {\n        if (this.props.regenerateLocations != true && stored !== null){\n          return this.book.locations.load(stored);\n        } else {\n          return this.book.locations.generate(this.props.locationsCharBreak || 600).then((locations) => {\n            // Save out the generated locations to JSON\n            AsyncStorage.setItem(key, this.book.locations.save());\n            return locations;\n          });\n        }\n      })\n\n    });\n  }\n\n  onRelocated(visibleLocation) {\n    this._visibleLocation = visibleLocation;\n\n    if (this.props.onLocationChange) {\n      this.props.onLocationChange(visibleLocation);\n    }\n  }\n\n  visibleLocation() {\n    return this._visibleLocation;\n  }\n\n  getRange(cfi) {\n    return this.book.getRange(cfi);\n  }\n\n  _handleAppStateChange(appState) {\n    if (appState === \"active\") {\n      this.active = true;\n    }\n\n    if (appState === \"background\") {\n      this.active = false;\n    }\n\n    if (appState === \"inactive\") {\n      this.active = false;\n    }\n  }\n\n  destroy() {\n    if (this.book) {\n      this.book.destroy();\n    }\n  }\n\n  render() {\n    return (\n      <Rendition\n        ref={(r) => {\n          this.rendition = r;\n\n          if (this.needsOpen) {\n            this._openBook.apply(this, this.needsOpen);\n            this.needsOpen = undefined;\n          }\n        }}\n        url={this.props.src}\n        flow={this.props.flow}\n        minSpreadWidth={this.props.minSpreadWidth}\n        stylesheet={this.props.stylesheet}\n        webviewStylesheet={this.props.webviewStylesheet}\n        script={this.props.script}\n        onSelected={this.props.onSelected}\n        onMarkClicked={this.props.onMarkClicked}\n        onPress={(this.props.onPress)}\n        onLongPress={(this.props.onLongPress)}\n        onViewAdded={this.props.onViewAdded}\n        beforeViewRemoved={this.props.beforeViewRemoved}\n        themes={this.props.themes}\n        theme={this.props.theme}\n        fontSize={this.props.fontSize}\n        font={this.props.font}\n        display={this.props.location}\n        onRelocated={this.onRelocated.bind(this)}\n        orientation={this.state.orientation}\n        backgroundColor={this.props.backgroundColor}\n        onError={this.props.onError}\n        onDisplayed={this.props.onDisplayed}\n      />\n    );\n  }\n}\n\nmodule.exports = Epub;\n"]}